#!/bin/bash

# retry_with_fixes - A utility to retry commands with automatic fixes
# Usage: retry_with_fixes "description" "command"

DESCRIPTION="$1"
COMMAND="$2"
MAX_RETRIES=3
RETRY_COUNT=0

echo "Starting: $DESCRIPTION"

while [ $RETRY_COUNT -lt $MAX_RETRIES ]; do
    echo "Attempt $((RETRY_COUNT + 1))/$MAX_RETRIES: $DESCRIPTION"
    
    if eval "$COMMAND"; then
        echo "‚úÖ Success: $DESCRIPTION"
        exit 0
    else
        RETRY_COUNT=$((RETRY_COUNT + 1))
        echo "‚ùå Failed: $DESCRIPTION (attempt $RETRY_COUNT)"
        
        if [ $RETRY_COUNT -lt $MAX_RETRIES ]; then
            echo "Retrying in 2 seconds..."
            sleep 2
        fi
    fi
done

echo "üí• All attempts failed for: $DESCRIPTION"
exit 1